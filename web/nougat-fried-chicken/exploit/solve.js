// SOLUTION: 94563
const MAX_LENGTH = 5
const TARGET_HASH = 155387

// Who wrote this code!? What the hell is wrong with people???
const elliotCipher = (secret, pwd) => {
    let i = 0;
    let almostThere = ""; // you wish lol
    for (let j = 0; j < secret.length; j++) {
        almostThere += String.fromCharCode((pwd.charCodeAt(i++)) ^ (secret.charCodeAt(j)));
        if (i >= pwd.length) i = 0;
    }
    return almostThere;
}

const hashPass = (pass) => {
    let hash = 0;
    for (j = 0; j < pass.length; j++) {
        const n = pass.charCodeAt(j);
        hash += ((n - j + 33) ^ 31025);
    }
    return hash
}

const evilFunc = (pass) => {
    const hash = hashPass(pass)

    if (hash == TARGET_HASH) {
        const secret = "" + "\x6D\x5C\x50\x16\x43\x58\x47\x46\x16\x58\x5C\x4D\x15\x5F\x40\x19\x5A\x5A\x42\x13\x4D\x5C\x50\x16\x55\x55\x55\x52\x16\x5C\x5F\x14\x41\x5E\x56\x19\x67\x7C\x78\x75\x19\x77\x61\x70\x13\x5A\x5C\x54\x5A\x5F\x5C\x5A\x52\x53\x1D\x19\x76\x40\x42\x13\x40\x5B\x40\x11\x41\x5C\x14\x5C\x58\x13\x4D\x5C\x50\x16\x41\x50\x53\x5D\x42\x13\x5D\x5D\x47\x53\x50\x4D\x5D\x5A\x58\x1F\x19\x5F\x50\x53\x43\x19\x53\x5A\x5F\x5D\x5E\x14\x54\x58\x57\x19\x4D\x5A\x43\x14\x55\x58\x15\x53\x45\x5C\x5A\x41\x43\x52\x55\x58\x4C\x16\x54\x5C\x40\x15\x42\x5B\x5C\x46\x50\x18\x13\x7E\x5B\x5A\x52\x13\x55\x41\x56\x5D\x12" + "";
        const passkey = elliotCipher(secret, pass);
        return passkey;
    } else {
        console.log('Wrong password!');
    }
}

const permutations = (k, curr_perm, included_items_hash) => {
    if(k==0){
        perms.push(curr_perm);
        return;
    }

    for(let i=0; i<items.length; i++){
        // so that we do not repeat the item, using an array here makes it O(1) operation
        if(!included_items_hash[i]){
            included_items_hash[i] = true;
            permutations(k-1, curr_perm+items[i], included_items_hash);
            included_items_hash[i] = false;
        }
    }
 }

const items = [...'1234567890'];
let perms = []

for(let i=0; i <= MAX_LENGTH; i++){
    console.log("Length: ", i)
    perms = []
    permutations(i, "", []);
    for (perm of perms) {
        if (hashPass(perm) == TARGET_HASH) {
            secret = evilFunc(perm)
            if (secret.includes("flag")) {
                console.log("Pass: ", perm)
                console.log("Secret: ", secret)
            }
        }
    }
}
console.log("Finished")
